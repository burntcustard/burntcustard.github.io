<head><style>button{background:0;border:0;border-radius:0;font-family:monospace;pointer-events:all}:focus-visible{outline:0}body{--color-primary:#fff;--color-secondary:#aaa;--color-accent:#f60;background:#111;font-family:monospace;height:100vh;margin:0}.tri:after,.tri:before{clip-path:polygon(0 100%,50% 0,100% 100%)}.dia:after,.dia:before{clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}.hex:after,.hex:before{clip-path:polygon(25% 0,75% 0,100% 50%,75% 100%,25% 100%,0 50%)}.hex-cut,.hex-cut:after,.hex-cut:before{clip-path:polygon(25% 0,75% 0,100% 50%,75% 100%,25% 100%,0 50%,25% 0,calc(25% + var(--tx)/2) var(--t),var(--tx) 50%,calc(25% + var(--tx)/2) calc(100% - var(--t)),calc(75% - var(--tx)/2) calc(100% - var(--t)),calc(100% - var(--tx)) 50%,calc(75% - var(--tx)/2) var(--t),calc(25% + var(--tx)/2) var(--t))}.oct:after,.oct:before{clip-path:polygon(29.34% 0,70.66% 0,100% 29.34%,100% 70.66%,70.66% 100%,29.34% 100%,0 70.66%,0 29.34%)}.octish:after,.octish:before{clip-path:polygon(15% 0,85% 0,100% 15%,100% 85%,85% 100%,15% 100%,0 85%,0 15%)}.circle{border-radius:50%}.face,.shape{align-items:center;display:flex;justify-content:center}.face{backface-visibility:hidden}.face:before{bottom:0;filter:brightness(var(--l));left:0;right:0;top:0;z-index:-1}.face:after,.face:before{box-sizing:border-box;content:"";position:absolute}.face:after{height:100%;width:100%}.face.ao-outer{backface-visibility:visible!important}.face.ao-outer:after{box-shadow:0 0 7px 3px #0006;transform:translateZ(-.5px)}.shape:not(.select):not(.hover) .face:not(.build-hover).ao:after{border-color:#0000;border-bottom:2px solid var(--ao-b,#0000);border-left:2px solid var(--ao-l,#0000);border-right:2px solid var(--ao-r,#0000);border-top:2px solid var(--ao-t,#0000);box-sizing:border-box;filter:blur(4px)}.face.build-hover:after{animation:spin 1.5s linear infinite;-webkit-backface-visibility:hidden;background:radial-gradient(#0ff 50%,#0000 0);background-position:50%;background-repeat:no-repeat;background-size:20px 20px;border-color:#0000 #0ff;border-radius:50%;border-style:solid;border-width:3px;box-sizing:border-box;content:"";height:32px;position:absolute;width:32px}.face.build-hover.err-cost:after,.face.build-hover.obstructed:after{animation-duration:5s;background-image:radial-gradient(#f02 50%,#0000 0);border-left-color:#f02b;border-right-color:#f02b}@keyframes spin{0%{transform:rotate(0deg) translateZ(1px)}to{transform:rotate(1turn) translateZ(1px)}}.face:nth-child(1n):before{background:rgba(255,0,0,.8)}.face:nth-child(2n):before{background:rgba(255,191,0,.8)}.face:nth-child(3n):before{background:rgba(128,255,0,.8)}.face:nth-child(4n):before{background:rgba(0,255,64,.8)}.face:nth-child(5n):before{background:rgba(0,255,255,.8)}.face:nth-child(6n):before{background:rgba(0,64,255,.8)}.face:nth-child(7n):before{background:rgba(128,0,255,.8)}.face:nth-child(8n):before{background:rgba(255,0,234,.8)}.face:nth-child(9n):before{background:rgba(255,0,85,.8)}.module.shape:not(.frame) .face:before{animation:build 1s forwards}@keyframes build{0%{box-shadow:inset 0 0 0 100px #0ff0;transform:scale(0)}50%{box-shadow:inset 0 0 0 100px #0ff9;transform:scale(1)}to{box-shadow:inset 0 0 0 100px #0ff0}}.shape.block .face.rect:before{background:#aaa}.shape.hab-sm .face.rect{backface-visibility:visible;background:#013a}.shape.hab-sm .face:before{background:#eee}.shape.hab-sm .face.rect:nth-child(4n):before{--window-h:8px;--window-w:20px;background:linear-gradient(#0000 calc(50% + var(--window-h) - 1px),var(--color-accent) 0 calc(50% + var(--window-h) + 6px),#0000 0),linear-gradient(90deg,#eee calc(50% - var(--window-w)),#0000 0 calc(50% + var(--window-w)),#eee 0),linear-gradient(#eee calc(50% - var(--window-h)),#0000 0 calc(50% + var(--window-h)),#eee 0)}.shape.box.hangar .face:before{background:#aaa}.shape.box.hangar .door{overflow:hidden}.shape.box.hangar .door:before{animation:slide 16s linear infinite forwards;background:repeating-linear-gradient(-75deg,#0cf3 2px,#0cf8 3px,#eff8 4px,#0cf8 5px,#0cf3 6px 8px);filter:none;left:-50%;right:-50%}@keyframes slide{0%{transform:translateX(25%)}to{transform:translateX(-25%)}}.shape.box.hangar .door:after{box-shadow:inset 0 0 2px 2px #def,inset 0 0 8px 2px #0af}.shape.box.hangar .face:nth-child(2):before{background:#333;filter:none}.shape.box.hangar .face:nth-child(9):after,.shape.box.hangar .face:nth-child(11):after,.shape.box.hangar .face:nth-child(13):after,.shape.box.hangar .face:nth-child(15):after{background:linear-gradient(90deg,#000a,#0008 82px,#0000 0),linear-gradient(90deg,#0000 82px,#fff 0,#0000 84px),linear-gradient(90deg,#0000 82px,#0af 0,#0000)}.shape.hex-block .face:before,.shape.hex-ring .face:before{background:var(--color-primary)}.shape.scaffold .face.rect:before{background:linear-gradient(45deg,#0000 0 calc(50% - 2px),var(--color-secondary) 0 calc(50% + 2px),#0000 0),linear-gradient(-45deg,#0000 0 calc(50% - 2px),var(--color-secondary) 0 calc(50% + 2px),#0000 0);border:3px solid var(--color-secondary)}.shape.scaffold .face:nth-child(n+7):before{transform:translateZ(1px)}.shape.box.solar:not(.frame),.shape.box.solar:not(.frame) .face{transition:all 1s}.shape.box.solar .face:before{background:#fff}.shape.box.solar .panel:before{background:repeating-linear-gradient(0deg,#0000 0 9px,#fff6 0 10px),repeating-linear-gradient(90deg,#0000 0 4px,#fff9 0 5px),linear-gradient(45deg,#059,#08a);background-repeat:no-repeat;border:2px solid #fff}.shape.solar:not(.frame) .panel:before{animation:build 1s forwards,extend 2s forwards}@keyframes extend{0%{background-size:0 100%}30%{background-size:0 100%}to{background-size:100% 100%}}.ui{align-items:center;box-sizing:border-box;display:flex;height:100vh;justify-content:center;overflow:hidden;padding:2vmin;perspective:300px;pointer-events:none;position:absolute;top:0;width:100vw}.ui *{transform-style:preserve-3d}.ui__hex{align-items:center;aspect-ratio:8/5;display:flex;height:100%;justify-content:center;max-height:55vw;position:relative}.ui__hex .side{box-sizing:border-box;display:flex;position:absolute;width:52.5%}.ui__hex .front{background:linear-gradient(-90deg,#0003,#0000 32px),linear-gradient(-162.6deg,#0003 16%,#0000 calc(16% + 32px));clip-path:polygon(50% 0,100% 25%,100% 75%,50% 100%,0 75%,0 25%);height:100%;width:100%}.ui__hex .bottom,.ui__hex .top{height:50%}.ui__hex .bottom--right,.ui__hex .top--right{left:50%}.ui__hex .bottom--left,.ui__hex .top--left{left:-2.5%}.ui__hex .top{align-items:flex-end;justify-content:center;top:-50%}.ui__hex .top--right{border-bottom:6px solid #404040;transform:rotate(17.4deg) rotateX(-90deg);transform-origin:bottom left}.ui__hex .top--left{border-bottom:6px solid #4d4d4d;transform:rotate(-17.4deg) rotateX(-90deg);transform-origin:bottom right}.ui__hex .left,.ui__hex .right{border-left:6px solid #595959;border-right:6px solid #595959;height:50%;top:25%}.ui__hex .right{align-items:center;left:100%;transform:rotateY(-90deg);transform-origin:left}.ui__hex .left{left:-52.5%;transform:rotateY(90deg);transform-origin:right}.ui__hex .bottom{top:100%}.ui__hex .bottom--right{border-top:6px solid #666;transform:rotate(-17.4deg) rotateX(90deg);transform-origin:top left}.ui__hex .bottom--left{border-top:6px solid #737373;transform:rotate(17.4deg) rotateX(90deg);transform-origin:top right}.ui__hex .side:before{border-color:#b3b3b3 #bfbfbf #ccc;border-style:solid;border-width:8px;bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:-1}.ui__hex .left:before,.ui__hex .right:before{border-left:8px solid #bfbfbf;border-right:8px solid #bfbfbf}.ui__hex .top .ui-panel{transform:rotateX(85deg) translateY(calc(6vmin - 16px))}button.build-bar:before{content:""}button.build-bar.block:before{background:conic-gradient(#fff 65deg,#ccc 0 180deg,#999 0 295deg,#fff 0);clip-path:polygon(50% 0,100% 25%,100% 75%,50% 100%,0 75%,0 25%);height:26px;width:26px}button.build-bar.scaffold:before{background:linear-gradient(45deg,#0000 0 calc(50% - 1px),var(--color-secondary) 0 calc(50% + 2px),#0000 0),linear-gradient(-45deg,#0000 0 calc(50% - 1px),var(--color-secondary) 0 calc(50% + 2px),#0000 0);box-shadow:0 0 0 3px var(--color-secondary);height:18px;width:22px}button.build-bar.hex-block:before{background:conic-gradient(#fff 65deg,#ccc 0 180deg,#999 0 295deg,#fff 0);clip-path:polygon(50% 0,100% 15%,100% 60%,50% 80%,0 60%,0 15%);height:36px;margin-top:8px;width:28px}button.build-bar.solar:before{background:repeating-linear-gradient(0deg,#0000 0 4px,#fff9 0 5px),repeating-linear-gradient(90deg,#0000 0 9px,#fff6 0 10px),linear-gradient(45deg,#059,#08a);border:2px solid #fff;height:24px;width:20px}button.build-bar.hangar:before{background-color:#197f9e;background-image:linear-gradient(180deg,hsla(0,0%,100%,.6) 0,hsla(0,0%,100%,0) 25%),linear-gradient(270deg,hsla(0,0%,100%,.6) 0,hsla(0,0%,100%,0) 25%),linear-gradient(0deg,hsla(0,0%,100%,.6) 0,hsla(0,0%,100%,0) 25%),linear-gradient(90deg,hsla(0,0%,100%,.6) 0,hsla(0,0%,100%,0) 25%);border:2px solid #fff;height:24px;width:24px}button.build-bar.hab-sm:before{background:linear-gradient(#ccc 4px,#fff 0 10px,#0000 0 16px,var(--color-accent) 0 18px,#fff 0 22px,#999 0),linear-gradient(90deg,#fff 0 5px,#0000 0 21px,#fff 0);height:26px;width:26px}button.build-bar.ring:before{--tx:4px;--t:3.5px;background:#fff;clip-path:polygon(25% 0,75% 0,100% 50%,75% 100%,25% 100%,0 50%,25% 0,calc(25% + var(--tx)/2) var(--t),var(--tx) 50%,calc(25% + var(--tx)/2) calc(100% - var(--t)),calc(75% - var(--tx)/2) calc(100% - var(--t)),calc(100% - var(--tx)) 50%,calc(75% - var(--tx)/2) var(--t),calc(25% + var(--tx)/2) var(--t));height:24px;width:28px}button.build-bar.ring:hover:before,button.build-bar.ring[aria-pressed=true]:before{animation:rotate 9s linear infinite}@keyframes rotate{to{transform:rotate(1turn)}}button.build-bar.upgrade:before{background:#088;clip-path:polygon(50% 0,100% 45%,75% 45%,75% 100%,25% 100%,25% 45%,0 45%);height:32px;position:absolute;width:32px;z-index:-1}.ui-panel__build-list{background:#333;box-shadow:inset 2px 2px #111,inset -2px -2px #222,inset 0 0 8px 8px #222;display:flex;grid-template-columns:repeat(auto-fill,minmax(44px,1fr));margin-bottom:-2px;margin-top:-1px;padding:1px;pointer-events:all}button.build-bar{align-items:center;box-shadow:inset 0 0 0 24px #222,inset 0 0 0 2px #c400,inset 0 0 0 24px #b400;box-sizing:border-box;color:#fff;display:flex;font-size:12px;font-weight:700;justify-content:center;margin:1px;overflow:hidden;transition:box-shadow .2s;width:52px}button.build-bar.upgrade{width:106px}button.build-bar:disabled{color:#999}button.build-bar:disabled:before{opacity:.5}button.build-bar:disabled:after{background:linear-gradient(to top left,#0000 0 calc(50% - 1px),#fff 0 calc(50% + 1px),#0000 0),linear-gradient(to bottom left,#0000 0 calc(50% - 1px),#fff 0 calc(50% + 1px),#0000 0);border:2px solid #222;box-shadow:inset 0 0 0 2px #fff;box-sizing:border-box;content:"";height:100%;opacity:.3;position:absolute;width:100%}button.build-bar:not(:disabled):hover{box-shadow:inset 0 0 0 0 #222,inset 0 0 0 2px #c404,inset 0 0 0 26px #b404}button.build-bar[aria-pressed=true]{box-shadow:inset 0 0 0 0 #222,inset 0 0 0 2px #c40,inset 0 0 0 24px #b403}button.build-bar[aria-pressed=true]:hover{box-shadow:inset 0 0 0 0 #222,inset 0 0 0 2px #c40,inset 0 0 0 24px #b404}.ui-panel__build-info{background:#b40;background-image:repeating-linear-gradient(0deg,#0000 0 6px,#a30 0 8px),repeating-linear-gradient(90deg,#0000 0 6px,#a30 0 8px);background-position:6px 3px;border:3px solid #aaa;box-shadow:inset 4px 4px 0 #0005,inset -3px -2px 0 #0005,0 1px 3px #000;color:#fff;font-size:14px;padding:5px 6px 4px;pointer-events:all;text-shadow:0 0 2px #000;width:300px}.ui-panel__build-info--select{background:#077;background-image:repeating-linear-gradient(45deg,#0000 1px 4px,#088 0 6px),repeating-linear-gradient(135deg,#0000 1px 4px,#088 0 6px);background-position:0 0,0 100%;background-repeat:no-repeat;background-size:100% 50%}.ui-panel__build-info>div{display:flex;justify-content:space-between}.eco{display:flex;gap:6px}.eco .dot{background:#333;box-sizing:border-box;font-size:20px;font-weight:600;height:28px;line-height:28px;text-align:center;transition:all .2s;width:28px}.eco.mats .dot:not(.empty){background:#0fd;border-bottom:2px solid #0aa;border-right:1px solid #0a9;box-shadow:0 0 6px #0fd,0 0 0 1px #333}.eco.power .dot:not(.empty){background:#ff0;border-bottom:2px solid #ca0;border-right:1px solid #cb0;box-shadow:0 0 6px #fd0,0 0 0 1px #333}.eco .bar{background:#333;box-shadow:inset 0 1px #222,0 1px #aaa;height:5px;position:relative;width:102px}.eco .bar:after{background:repeating-linear-gradient(90deg,#333,3px,#0000 0 9px);content:"";height:7px;left:0;position:absolute;right:0;top:-12px}.eco .bar .fill{height:4px;transition:width .5s linear}.eco.mats .bar .fill{background:#0fd;border-bottom:1px solid #0aa;box-shadow:0 0 6px #0fd,0 0 0 1px #333;margin-left:auto}.eco.power .bar .fill{background:#ff0;border-bottom:1px solid #ca0;box-shadow:0 0 6px #fd0,0 0 0 1px #333}.eco .bar .cap{color:#000;font-size:11px;line-height:16px}.eco.power .bar .cap{text-align:right}.eco .nums{align-items:center;background:#333;box-shadow:inset 2px 2px #222;display:flex;font-size:14px;margin-bottom:-2px;padding:0 4px}.eco .use{margin-top:5px}.eco .gen,.eco .num{color:#0f9}.eco .num{font-size:18px;margin-left:4px}.eco .num.neg,.eco .use{color:#f20}.pop .icon{border-radius:50%;box-shadow:inset 0 -2px 0 6px #333;height:20px;width:20px}.pop .icon:before{background:#777;border-radius:3px;bottom:-2px;content:"";height:9px;left:6px;position:absolute;width:8px}.pop .icon~*{margin-top:1px}.pop .cap,.pop .cur{display:flex;justify-content:center;min-width:16px}.ui-panel{background:linear-gradient(135deg,#333 50%,#444 0);border:3px solid #aaa;box-shadow:1px 1px 9px #000;padding:8px;transition:all .3s}.ui-panel__inner{align-items:center;background:#777;box-shadow:0 1px 0 2px #222;display:flex;gap:8px;padding:8px}.ui-panel--top,.ui-panel__big{padding:6px 8px}.ui-panel--top{font-weight:700;position:absolute;top:2vmin;transform:rotateX(-9deg) translateZ(12px)}.ui-panel--big{bottom:3vh;display:flex;gap:18px;height:46px;position:absolute;transform:rotateX(9deg)}.ui-right{direction:rtl;transform:translateX(.5vw);width:0}.ui-right .ui-panel{direction:ltr;width:44px}.ui-right .ui-panel__inner{display:flex;flex-direction:column}.ui-panel.ui-panel--btns{overflow:hidden;padding:8px 0;width:54px}.ui-panel.ui-panel--btns[aria-hidden=true]{width:0}.ui-panel--btns .ui-panel__inner{display:flex;gap:6px;margin:0 8px;padding:4px;width:30px}.ui-panel--btns button{align-items:center;border-color:#5317 #5315;border-style:solid;border-width:0 2px 3px 0;box-shadow:0 0 0 1px #3339;display:flex;font-weight:700;height:28px;justify-content:center;padding-top:2px;text-shadow:0 0 1px #000;transition:box-shadow .2s;width:28px}.ui-panel--btns button:active{border-width:1px 1px 2px}.ui-panel--btns button[aria-pressed=true]{background:#fffa}.del-wrap{background:repeating-linear-gradient(-45deg,#000,#ff0 2px 4px,#000 0 6px);box-shadow:0 0 0 1px #3339}button.del{background:#e00;color:#fff;font-size:12px;height:26px;margin:3px;width:26px}button.del:hover{box-shadow:0 0 0 1px #3339,0 0 6px #e00}button.del:hover:before{box-shadow:0 0 6px #f33,0 0 0 1px #333}button.off{background:#ff0;color:#000;font-size:20px}button.off:hover{box-shadow:0 0 6px #fc3,0 0 0 1px #333}button.off[aria-pressed=true]:after{bottom:0;color:#e00;content:"×";font-size:16px;position:absolute;right:2px}button.off[aria-pressed=true]:hover{box-shadow:0 0 6px #fff7,0 0 0 1px #333}.ui-left{transform:translateX(-.5vw);width:0;z-index:1}.ui-panel--info{overflow:hidden;padding:8px 0;width:182px}.ui-panel--info[aria-hidden=true]{width:0}.ui-left .ui-panel__inner{display:flex;flex-direction:column;margin:0 8px;width:150px}.camera{height:0;left:50vw;position:relative;top:50vh;width:0}.debug{background:rgba(80,80,80,.5);color:#fff;left:0;padding:.5em 1em;position:absolute;top:0}.shape.ship .face:before{background:var(--color-accent);color:#fff;content:attr(data-text);font-size:8px;line-height:26px;text-align:center}.shape.ship .face:first-child:before{background:linear-gradient(var(--color-accent) 8px,#000 0 12px,var(--color-accent) 0)}.shape.ship .face.engine{backface-visibility:visible;background:#677;box-shadow:0 0 0 0 #5ff;transition:all 1s}.shape.ship.thrust .face.engine{background:#6ff;box-shadow:0 0 3px 1px #5ff}.shape.ship .face.engine:before{display:none}.shape.ship .face.engine:after{backface-visibility:visible;background:linear-gradient(#5ff,#0000);height:8px;top:1px;transform:rotateX(90deg) scaleY(0);transform-origin:top;transition:all 1s}.shape.ship.thrust .face.engine:after{transform:rotateX(90deg) scaleY(2)}.hover .face:after,.select .face:after{border:2px solid #0ffb;bottom:0;content:"";left:0;position:absolute;right:0;top:0}.select .face:after{background:#0ff3}.planet{align-items:center;display:flex;justify-content:center;pointer-events:none}.planet *{position:absolute}.planet .body{background:linear-gradient(blue,red,blue);box-shadow:inset 30px -30px 60px #000e,inset 9px 9px 20px #eef3,inset -1px 1px 3px 1px #fff8}.planet .ring{-webkit-backface-visibility:visible;border-radius:50%;box-shadow:0 0 1px 4px #ff0}.scene{transform-origin:0 0}.scene *{position:absolute}.sun{background:#f90;box-shadow:0 0 26px #f60,0 0 99px #ffcb;overflow:hidden;transform-origin:center}.sun svg{height:100%;width:100%}.viewport{height:100vh;overflow:hidden;touch-action:none;width:100vw}.viewport *{box-sizing:border-box;transform-style:preserve-3d}.frame{transition:transform .2s}.frame .face:before{backface-visibility:hidden;opacity:.1}.frame .face{backface-visibility:visible;pointer-events:none}.frame.hab-sm .face{background:none!important}.frame .face:after{background:#fff2;border:2px solid #fffa;transform:translateZ(-.1px)}.frame.err-cost .face:after,.frame.obstructed .face:after{background:#f022;border:2px solid #f02b}.skybox .face:before{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='a'%3E%3CfeTurbulence baseFrequency='.2'/%3E%3CfeColorMatrix values='0 0 0 9 -5 0 0 0 9 -5 0 0 0 9 -5 0 0 0 0 1'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23a)'/%3E%3C/svg%3E")}</style></head><body><div class=viewport oncontextmenu="return false"><div class=camera><div class=scene></div></div></div><div class=ui><div class=ui-left><div class="ui-panel ui-panel--left ui-panel--info" aria-hidden=true><div><div class=ui-panel__inner><div class=name></div><div class=info></div></div></div></div></div><div class=ui__hex><div class=front></div><div class="ui-panel ui-panel--top"><div class="eco pop"><div class=ui-panel__inner><div class=icon></div><div class=cur></div>/<div class=cap></div></div></div></div><div class="side top top--left"><div class=ui-panel><div class="eco mats"><div class=ui-panel__inner><div class=bar><div class=fill></div><div class=cap>0</div></div><div class=dot>M</div></div></div></div></div><div class="side top top--right"><div class=ui-panel><div class="eco power"><div class=ui-panel__inner><div class=dot>ϟ</div><div class=bar><div class=fill></div><div class=cap></div></div></div><div class=nums><div><div class=gen></div><div class=use></div></div><div class=num></div></div></div></div></div><div class="side right"></div><div class="side bottom bottom--right"></div><div class="side bottom bottom--left"></div><div class="side left"></div></div><div class="ui-panel ui-panel--big"><div class=ui-panel__build-list></div><div class=ui-panel__build-info></div></div><div class=ui-right><div class="ui-panel ui-panel--right ui-panel--btns" aria-hidden=true><div><div class=ui-panel__inner><div class=del-wrap><button class=del>DEL</button></div><button class=off>ϟ</button></div></div></div></div></div><div class=debug><div class=view>...</div><div class=perf>...</div><div><span>Reset</span> <button id=reset-rotation>Rotation</button> <button id=reset-position>Position</button></div><div class=ship-controller></div></div><script>!function(){const t=t=>t*(Math.PI/180),i=t=>180*t/Math.PI,s=t=>document.querySelector(t),h=Math.PI,n=Math.PI/2,e=Math.PI/3,a=Math.PI/4,r=Math.PI/8,o=3*a,c=.2,l=500,u=.01,w={max:4e4,default:500,min:100},x=1,d=s(".camera"),z=s(".scene"),y=s(".viewport"),p=s(".debug .view"),b=new function(){this.x=0,this.y=0,this.z=0,this.rx=t(45),this.ry=0,this.t=t(45),this.dx=0,this.dy=0,this.zoom=w.default,this.i=0,this.h=0,this.o=0,this.l=[],this.l=[],this.perspective=l,y.style.perspective=this.perspective+"px",this.setTransform=()=>{this.rx=Math.min(Math.max(this.rx,0),Math.PI),z.style.transform=`rotateX(${this.rx}rad) rotateZ(${this.t}rad) translateX(${this.x}px) translateY(${this.y}px)`},this.u=()=>{this.zoom=Math.min(Math.max(this.zoom,w.min),w.max),d.style.transform=`translateZ(${l-this.zoom}px)`},this.setTransform(),this.u(),this.rotate=(t,i)=>{this.t+=t*u,this.rx+=i*u,this.l.forEach((t=>t.p(this))),this.setTransform()},this.m=t=>{this.zoom+=t*this.zoom*x/500,this.l.forEach((t=>t.p(this))),this.u()},this.update=t=>{(this.o||this.h)&&(this.o&&this.h&&(this.o*=.7071,this.h*=.7071),this.h&&(this.dx+=this.h*Math.sin(this.t),this.dy+=this.h*Math.cos(this.t),this.h=0),this.o&&(this.dx-=this.o*Math.cos(this.t),this.dy+=this.o*Math.sin(this.t),this.o=0),this.x+=this.dx*c*(this.zoom/300)*t,this.y+=this.dy*c*(this.zoom/300)*t,this.dx=0,this.dy=0,this.setTransform(),this.l.forEach((t=>t.p(this)))),this.i&&(this.m(this.i*t),this.i=0),p.innerText=`Position: ${Math.round(this.x)}x, ${Math.round(this.y)}y, ${Math.round(this.z)}z\nRotation: ${Math.round(i(this.rx))}°x, ${Math.round(i(this.t))}°z\nZoom: ${Math.round(this.zoom)}px`}},f={M:{_:1e3,$:500},g:{_:1,$:1},v:{N:0,k:0,_:100,$:100}},m=[];m.remove=function(t){this.splice(this.findIndex((i=>i===t)),1)},m.O=function(){return this.filter((t=>t.selected))},m.j=function(){for(let t=this.length-1;t>0;t--)this[t].selected&&this[t].B()},m.D=function(){for(let t=this.length-1;t>0;t--)this[t].selected&&this[t].upgrade&&this[t].level<this[t].S&&this[t].upgrade()},m.deselectAll=function(){m.forEach((t=>{t.selected&&t.select(!1)}))};class M{constructor(t,i,s){this.x=t,this.y=i,this.z=s}I(t){return this.x*t.x+this.y*t.y+this.z*t.z}Z(t){return new M(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}add(t){return new M(this.x+t.x,this.y+t.y,this.z+t.z)}X(t){return new M(this.x-t.x,this.y-t.y,this.z-t.z)}length(){return Math.hypot(this.x,this.y,this.z)}resize(t){return this.multiply(t/this.length())}H(t){return Math.acos(this.I(t)/(this.length()*t.length()))}A(t){return t.X(this).length()}P(){return Math.atan2(this.z,this.y)}R(){return Math.atan2(this.z,this.x)}T(){return Math.atan2(this.y,this.x)}W(){const t=this.length();return new M(this.x/t,this.y/t,this.z/t)}multiply(t){return new M(this.x*t,this.y*t,this.z*t)}rotate(t,i,s){return this.G(t).C(i).Y(s)}G(t){const i=Math.cos(t),s=Math.sin(t);return new M(this.x,this.y*i-this.z*s,this.y*s+this.z*i)}C(t){const i=Math.cos(t),s=Math.sin(t);return new M(this.x*i+this.z*s,this.y,-this.x*s+this.z*i)}Y(t){const i=Math.cos(t),s=Math.sin(t);return new M(this.x*i-this.y*s,this.x*s+this.y*i,this.z)}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}}const _={U:!1,q:!1,L:!1,F:!1,rotation:0,J:t=>{if(!t)return _.L&&_.L.element.classList.remove("build-hover"),_.q&&(_.q.K.element.style.display="none"),_.U=!1,void(_.q=!1);_.U=t,_.q=new t({}),_.q.V()},tt:()=>{_.F=f.M.$<_.U.it},update:()=>{_.U&&(_.tt(),_.q.K.element.classList.toggle("err-cost",_.F),_.L&&_.L.element.classList.toggle("err-cost",_.F))},st:()=>{_.q.rx=_.rotation,_.q.update()},ht:t=>{const i=t.parent.nt.indexOf(t);if(0===i)for(let i=1;i<t.parent.nt.length-1;i++)t.parent.nt[i].element.style.setProperty("--ao-l","#000"),t.parent.nt[i].element.classList.add("ao");if(1===i&&(t.parent.nt[0].element.classList.add("ao"),t.parent.nt[0].element.style.setProperty("--ao-b","#000"),t.parent.nt[2].element.classList.add("ao"),t.parent.nt[2].element.style.setProperty("--ao-b","#000"),t.parent.nt[3].element.classList.add("ao"),t.parent.nt[3].element.style.setProperty("--ao-t","#000"),t.parent.nt[5].element.classList.add("ao"),t.parent.nt[5].element.style.setProperty("--ao-b","#000")),2===i&&(t.parent.nt[0].element.classList.add("ao"),t.parent.nt[0].element.style.setProperty("--ao-r","#000"),t.parent.nt[1].element.classList.add("ao"),t.parent.nt[1].element.style.setProperty("--ao-t","#000"),t.parent.nt[4].element.classList.add("ao"),t.parent.nt[4].element.style.setProperty("--ao-b","#000"),t.parent.nt[5].element.classList.add("ao"),t.parent.nt[5].element.style.setProperty("--ao-l","#000")),3===i&&(t.parent.nt[0].element.classList.add("ao"),t.parent.nt[0].element.style.setProperty("--ao-l","#000"),t.parent.nt[1].element.classList.add("ao"),t.parent.nt[1].element.style.setProperty("--ao-b","#000"),t.parent.nt[4].element.classList.add("ao"),t.parent.nt[4].element.style.setProperty("--ao-t","#000"),t.parent.nt[5].element.classList.add("ao"),t.parent.nt[5].element.style.setProperty("--ao-r","#000")),4===i&&(t.parent.nt[0].element.classList.add("ao"),t.parent.nt[0].element.style.setProperty("--ao-t","#000"),t.parent.nt[2].element.classList.add("ao"),t.parent.nt[2].element.style.setProperty("--ao-t","#000"),t.parent.nt[3].element.classList.add("ao"),t.parent.nt[3].element.style.setProperty("--ao-b","#000"),t.parent.nt[5].element.classList.add("ao"),t.parent.nt[5].element.style.setProperty("--ao-t","#000")),5===i)for(let i=0;i<t.parent.nt.length-1;i++)t.parent.nt[i].element.classList.add("ao"),t.parent.nt[i].element.style.setProperty("--ao-r","#000")},et:t=>{t.at=()=>{if(!_.U)return;const i=_.q,s=i.K,h=t.parent,n=new M(t.x,t.y,t.z).G(h.rx).C(h.ry).Y(h.t),e=n.W(),a=n.resize(.5*s.w);s.element.style.display="",t.element.classList.add("build-hover"),t.element.classList.toggle("obstructed",t.rt??!1),s.element.classList.toggle("obstructed",t.rt??!1),_.L=t,i.x=h.x+n.x+a.x,i.y=h.y+n.y+a.y,i.z=h.z+n.z+a.z,i.rx=_.rotation,i.ry=-Math.asin(e.z),i.t=Math.atan2(n.y,n.x),i.update()},t.ot=()=>{_.U&&(t.element.classList.remove("build-hover"),_.q.K.element.style.display="none",_.L=null)},t.ct=()=>{!_.U||t.rt||_.F||(_.q.lt(),m.push(_.q),t.rt=_.q,_.q.rt=t,t.element.classList.add("obstructed"),_.q.K.nt[0].w>t.w&&"Block"===t.parent.parent.tag&&(t.element.classList.add("ao-outer"),_.ht(t)),_.q.K.nt[0].w<t.w&&"Block"===_.q.tag&&(_.q.K.nt[0].element.classList.add("ao-outer"),_.ht(_.q.K.nt[0])),_.J(_.U),_.q.K.element.classList.add("obstructed"))},t.element.addEventListener("mouseover",t.at),t.element.addEventListener("mouseleave",t.ot),t.element.addEventListener("click",t.ct)},rotate:()=>{_.U&&(_.rotation=(_.rotation+n)%(2*h),_.st())}},$=t=>`\n  <div>\n    <b>${t.tag}</b>\n    <div>M:${t.it}${t.g?" | Pop:"+t.g:""}${0>t.v?" | Use ϟ"+-t.v:t.v>0?" | Gen ϟ"+t.v:""}</div>\n  </div>\n  <div>\n    ${t.ut}\n  </div>\n`,g=s(".ui-panel__build-info");function v(t){this.w=t.w??1,this.wt=t.wt??1,this.d=t.d??1,this.x=t.x??0,this.y=t.y??0,this.z=t.z??0,this.rx=t.rx??0,this.ry=t.ry??0,this.t=t.t??0}function N(t){v.call(this,t),this.tag=t.tag,this.ut=t.ut??"",this.it=t.it,this.v=t.v??0,this.g=t.g??0,this.K.parent=this}function k({w:t,wt:i,d:s,x:h,y:n,z:e,rx:a,ry:r,t:o,className:c}){this.w=t,this.wt=i,this.d=s??t,this.x=h??0,this.y=n??0,this.z=e??0,this.rx=a??0,this.ry=r??0,this.t=o??0,this.element=document.createElement("div"),this.element.className="shape "+c}function O({w:t,wt:i,x:s,y:h,z:n,rx:e,ry:a,t:r,xt:o,className:c,parent:l}){this.w=t,this.wt=i,this.x=s??0,this.y=h??0,this.z=n??0,this.t=r??0,this.ry=a??0,this.rx=e??0,this.dt=.5,this.xt=o??new M(1,0,0),this.element=document.createElement("div"),this.element.className="face "+(c??"rect"),this.parent=l,this.zt(),this.update()}function j({w:t,d:i=t,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:u}){this.className=(u??"")+" box",k.call(this,{w:t,d:i,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:this.className});const w=.5*t,x=.5*i,d=.5*s;this.nt=[new O({w:i,wt:s,x:-w,rx:-n,t:n}),new O({w:t,wt:i,z:-d,rx:h}),new O({w:t,wt:s,y:x,rx:-n}),new O({w:t,wt:s,y:-x,rx:n}),new O({w:t,wt:i,z:d}),new O({w:i,wt:s,x:w,rx:-n,t:-n})],this.nt.forEach((t=>{t.parent=this})),this.element.append(...this.nt.map((t=>t.element)))}v.prototype.update=function(t,i){this.K.x=this.x,this.K.y=this.y,this.K.z=this.z,this.K.rx=this.rx,this.K.ry=this.ry,this.K.t=this.t,this.K.update(t,i)},v.prototype.yt=function(){this.K.yt(),this.update()},v.prototype.bt=function(){return`\n    <div>\n      <b>${this.tag+"+".repeat(this.level??0)}</b>\n      <div>${this.active?"":"<s>"}${0>this.v?"Use ϟ"+-this.v:this.v>0?"Gen ϟ"+this.v:""}${this.active?"":"</s>"}</div>\n    </div>\n    <div>\n      ${this.ut}\n    </div>\n  `},v.prototype.ft=function(){if(this.upgrade){const t=document.createElement("button");t.className="build-bar upgrade",t.innerHTML="UPGRADE",t.disabled=this.level===this.S||f.M.$<this.Mt*(this.level+1),t.addEventListener("mouseover",(()=>{g.innerHTML=$({tag:this.tag+"+".repeat(this.level+1),it:this.Mt*(this.level+1),v:this.info.v*(this.level+2),ut:"Upgrade"})})),t.addEventListener("mouseleave",(()=>{g.innerHTML=this.bt()})),t.addEventListener("click",(()=>{f.M.$-=this.Mt*(this.level+1),this.upgrade(),this.ft()})),s(".ui-panel__build-list").innerHTML="",s(".ui-panel__build-list").append(t)}this._t&&this._t.forEach((t=>{const i=document.createElement("button");i.className="build-bar "+t.className,i.addEventListener("click",(()=>{new t({x:this.x,y:this.y,z:this.z,parent:this}).yt()})),i.addEventListener("mouseover",(()=>{g.innerHTML=$(t)})),i.addEventListener("mouseleave",(()=>{g.innerHTML=this.bt()})),s(".ui-panel__build-list").innerHTML="",s(".ui-panel__build-list").append(i)}))},v.prototype.$t=function(){s(".ui-panel__build-info").classList.add("ui-panel__build-info--select"),s(".ui-panel__build-info").innerHTML=this.bt(),this.upgrade||this._t?1===m.O().length&&(s(".ui-panel__build-list").style.display="",this.ft()):s(".ui-panel__build-list").style.display="none"},v.prototype.select=function(t){this.selected=t,t?(s(".ui-panel--btns").setAttribute("aria-hidden",!1),this.K.element.classList.add("select"),this.$t()):this.K.element.classList.remove("select")},v.prototype.gt=function(t){_.U||(this.vt=t,this.K.element.classList.toggle("hover",t))},v.prototype.Nt=function(){this.K.nt.forEach((t=>{t.element.addEventListener("mouseover",(()=>{this.gt(!0)})),t.element.addEventListener("mouseleave",(()=>{this.gt(!1)})),t.element.addEventListener("click",(()=>{_.U||(m.forEach((t=>{this!==t&&t.select&&t.select(!1)})),this.select(!0))})),t.element.addEventListener("dblclick",(()=>{m.forEach((t=>{this.tag===t.tag&&t.select&&t.select(!0)})),s(".ui-panel__build-list").style.display="none"}))}))},v.prototype.B=function(){this.K.element?.remove(),this.rt&&(this.rt.rt=void 0),f.M.$=Math.min(f.M.$+this.it/2,f.M._),m.remove(this)},N.prototype=Object.create(v.prototype),N.prototype.constructor=N,N.prototype.update=function(t,i){v.prototype.update.call(this,t,i),this.active&&this.kt(t),this.Ot&&(this.Ot=Math.max(this.Ot-t,0),0===this.Ot&&this.enable())},N.prototype.kt=function(t){0>this.v&&(f.v.$=Math.max(f.v.$+this.v*(t/1e3),0),0===f.v.$&&this.jt()),this.v>0&&(f.v.$=Math.min(f.v.$+this.v*(t/1e3),f.v._))},N.prototype.disable=function(){this.active=!1,f.v.k+=0>this.v?this.v:0,f.v.N-=this.v>0?this.v:0,this.selected&&v.prototype.$t.call(this)},N.prototype.enable=function(){this.active=!0,f.v.k-=0>this.v?this.v:0,f.v.N+=this.v>0?this.v:0,this.selected&&v.prototype.$t.call(this)},N.prototype.V=function(){this.K.element.classList.add("frame"),this.K.element.style.display="none",v.prototype.yt.call(this)},N.prototype.yt=function(){v.prototype.yt.call(this),v.prototype.Nt.call(this)},N.prototype.lt=function(){f.M.$-=this.it,this.K.element.classList.remove("frame"),this.K.element.style.display="",v.prototype.Nt.call(this),f.g._+=this.g,this.enable()},N.prototype.jt=function(){this.disable(),this.Ot=3e3},N.prototype.B=function(){this.disable(),v.prototype.B.call(this)},k.prototype.yt=function(){document.querySelector(".scene").append(this.element)},k.prototype.p=function(){const t=Math.sin(this.rx),i=Math.sin(this.ry),s=Math.sin(this.t),h=Math.cos(this.rx),n=Math.cos(this.ry),e=Math.cos(this.t);this.element.style.transform=`\n    translate3D(${this.x}px, ${this.y}px, ${this.z}px)\n    matrix3d(\n      ${e*n},\n      ${s*n},\n      ${-i},\n      0,\n      ${e*i*t-s*h},\n      ${s*i*t+e*h},\n      ${n*t},\n      0,\n      ${e*i*h+s*t},\n      ${s*i*h-e*t},\n      ${n*h},\n      0,\n      0,\n      0,\n      0,\n      1\n    )\n  `},k.prototype.Bt=function(t){const i=Math.sin(this.rx),s=Math.sin(this.ry),h=Math.sin(this.t),n=Math.cos(this.rx),e=Math.cos(this.ry),a=Math.cos(this.t),r=[[a*e,a*s*i-h*n,a*s*n+h*i],[h*e,h*s*i+a*n,h*s*n-a*i],[-s,e*i,e*n]];this.nt.forEach((i=>{i.Bt(t,r)}))},k.prototype.update=function(t,i){this.p(),i&&i.length&&this.Bt(i)},O.prototype.zt=function(){this.element.style.width=this.w+"px",this.element.style.height=this.wt+"px"},O.prototype.p=function(){const t=Math.sin(this.rx),i=Math.sin(this.ry),s=Math.sin(this.t),h=Math.cos(this.rx),n=Math.cos(this.ry),e=Math.cos(this.t);this.element.style.transform=`\n    translate3D(${this.x}px, ${this.y}px, ${this.z}px)\n    matrix3d(\n      ${e*n},\n      ${s*n},\n      ${-i},\n      0,\n      ${e*i*t-s*h},\n      ${s*i*t+e*h},\n      ${n*t},\n      0,\n      ${e*i*h+s*t},\n      ${s*i*h-e*t},\n      ${n*h},\n      0,\n      0,\n      0,\n      0,\n      1\n    )\n  `},O.prototype.Bt=function(t,i){const s=Math.sin(this.rx),h=Math.sin(this.ry),n=Math.sin(this.t),e=Math.cos(this.rx),a=Math.cos(this.ry),r=Math.cos(this.t),o=[e*h*r+s*n,e*h*n-s*r,e*a],c=new M(i[0][0]*o[0]+i[0][1]*o[1]+i[0][2]*o[2],i[1][0]*o[0]+i[1][1]*o[1]+i[1][2]*o[2],i[2][0]*o[0]+i[2][1]*o[1]+i[2][2]*o[2]).W();let l=.2;t.forEach((t=>{l+=Math.max(c.I(t.direction),0)*t.Dt})),this.element.style.setProperty("--l",l)},O.prototype.update=function(){this.p()},j.prototype=Object.create(k.prototype),j.prototype.constructor=j,j.prototype.St=function({w:t,d:i,wt:s,x:h,y:n,z:e}){this.x=h??this.x,this.y=n??this.y,this.z=e??this.z,this.w=t=t??this.w,this.d=i=i??this.d,this.wt=s=s??this.wt;const a=.5*t,r=.5*i,o=.5*s;this.nt[0].w=i,this.nt[0].wt=s,this.nt[0].x=-a,this.nt[1].w=t,this.nt[1].wt=i,this.nt[1].z=-o,this.nt[2].w=t,this.nt[2].wt=s,this.nt[2].y=r,this.nt[3].w=t,this.nt[3].wt=s,this.nt[3].y=-r,this.nt[4].w=t,this.nt[4].wt=i,this.nt[4].z=o,this.nt[5].w=i,this.nt[5].wt=s,this.nt[5].x=a,this.nt.forEach((t=>{t.zt(),t.p()}))};const B={tag:"Block",ut:"Basic building block",className:"block module",it:10,w:60,d:60,wt:60};function D({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new j({w:B.w,wt:B.wt,d:B.d,x:t,y:i,z:s,rx:h,ry:n,t:e,className:B.className}),N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...B}),this.K.nt.forEach((t=>{_.et(t)}))}function S({w:t,wt:i,x:s,y:e,z:c,rx:l,ry:u,t:w,className:x}){this.className=(x??"")+" octabox",k.call(this,{w:t,d:t,wt:i,x:s,y:e,z:c,rx:l,ry:u,t:w,className:this.className});const d=.5*t,z=.5*i,y=Math.floor(i*Math.tan(r)*1.74),p=Math.floor(i*Math.tan(r)*.53),b=1.2*z*Math.sin(a);this.nt=[new O({w:i,wt:i,x:d,rx:-n,t:-n,className:"octish"}),new O({w:t,wt:y,z:-z,rx:h}),new O({w:t,wt:p,y:b,z:-b,rx:-o}),new O({w:t,wt:y,y:z,rx:-n}),new O({w:t,wt:p,y:b,z:b,rx:-a}),new O({w:t,wt:y,z:z}),new O({w:t,wt:p,y:-b,z:b,rx:a}),new O({w:t,wt:y,y:-z,rx:n}),new O({w:t,wt:p,y:-b,z:-b,rx:o}),new O({w:i,wt:i,x:-d,rx:-n,t:n,className:"octish"})],this.nt.forEach((t=>{t.parent=this})),this.element.append(...this.nt.map((t=>t.element)))}Object.assign(D,B),D.prototype=Object.create(N.prototype),D.prototype.constructor=D,D.prototype.lt=function(){N.prototype.lt.call(this)},S.prototype=Object.create(k.prototype),S.prototype.constructor=S;const I={tag:"Hab Sm",ut:"Small habitation module",className:"hab-sm module",it:10,v:-10,g:5,w:60,d:84,wt:84};function Z({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new S({w:I.w,wt:I.wt,d:I.d,x:t,y:i,z:s,rx:h,ry:n,t:e,className:I.className}),N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...I}),this.K.nt.forEach(((t,i)=>{(0===i||i%2||i===this.K.nt.length-1)&&_.et(t)}))}function X({w:t,d:i=t,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:u,It:w=8,Zt:x=0}){this.className=(u??"")+" box box-visible-inner",k.call(this,{w:t,d:i,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:this.className});const d=.5*t,z=.5*i,y=.5*s;this.nt=[new O({w:i,wt:s,x:-d,rx:-n,t:n}),new O({w:i-2*w,wt:s-2*w,x:0,rx:n,t:n}),new O({w:i-2*w,wt:s-2*w,x:d-x,rx:n,t:n}),new O({w:i,wt:w,x:d,z:y-w/2,rx:n,t:n}),new O({w:i,wt:w,x:d,z:w/2-y,rx:n,t:n}),new O({w:w,wt:s,x:d,y:w/2-z,rx:n,t:n}),new O({w:w,wt:s,x:d,y:z-w/2,rx:n,t:n}),new O({w:t,wt:i,z:-y,rx:h}),new O({w:t,wt:i,z:y-w,rx:h}),new O({w:t,wt:s,y:z,rx:-n}),new O({w:t,wt:s,y:-z+w,rx:-n}),new O({w:t,wt:s,y:-z,rx:n}),new O({w:t,wt:s,y:z-w,rx:n}),new O({w:t,wt:i,z:y}),new O({w:t,wt:i,z:-y+w})],this.nt.forEach((t=>{t.parent=this})),this.element.append(...this.nt.map((t=>t.element)))}function H({w:t,d:i,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:u}){this.className=(u??"")+" ship",k.call(this,{w:t,d:i,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:this.className});const w=t/2,x=t/4,d=i/2;this.nt=[new O({w:w,wt:i,z:2,rx:-.2,t:-h,className:"tri"}),new O({w:w+1,wt:i,z:1,x:-x-.5,ry:-.2,rx:.1,className:"tri"}),new O({w:w+1,wt:i,z:1,x:x-.5,ry:.2,rx:.1,className:"tri"}),new O({w:w,wt:i,z:-2,ry:h,rx:-.2,t:-h,className:"tri"}),new O({w:w+1,wt:20,z:-1,x:-x-.5,ry:h+.2,rx:.1,className:"tri"}),new O({w:w+1,wt:20,z:-1,x:x-.5,ry:h-.2,rx:.1,className:"tri"}),new O({w:t,wt:8,y:d,rx:-n,className:"dia"}),new O({w:x,wt:2,y:d+.1,rx:-n,className:"engine"})],this.nt.forEach((t=>{t.parent=this})),this.element.append(...this.nt.map((t=>t.element)))}Object.assign(Z,I),Z.prototype=Object.create(N.prototype),Z.prototype.constructor=Z,Z.prototype.lt=function(){N.prototype.lt.call(this)},X.prototype=Object.create(k.prototype),X.prototype.constructor=X,H.prototype=Object.create(k.prototype),H.prototype.constructor=H;const A={Xt:[],Ht:[],At:[],Pt:[],update(t,i){const n=this.At.filter((t=>null===t.Rt));for(;n.length&&this.Pt.length;){const t=n.pop(),i=this.Pt.pop();i.Tt(t),i.status="aligning",i.destination=t.Yt.Wt}this.Xt.forEach((s=>{switch(s.status){case"ready":s.Ct.Yt.active&&f.M.$<f.M._&&(s.Gt(),s.status="undocking",s.Ut=(1e4,3e4,1e4*(1-(n=Math.random()))+3e4*n));break;case"undocking":null===s.destination&&(s.status="mining",s.destination=new M(1e3,0,0).Y(Math.random()*h*2));break;case"mining":s.Ut=Math.max(s.Ut-t,0),s.v=Math.max(s.v-t/1e3*1,0),0===s.Ut&&(s.status="returning",s.destination={x:0,y:0,z:100});break;case"returning":null===s.destination&&(s.status="queuing",this.Pt.push(s));break;case"queuing":break;case"aligning":null===s.destination&&(s.status="docking",s.destination={x:s.Ct.Yt.x,y:s.Ct.Yt.y,z:s.Ct.Yt.z});break;case"docking":null===s.destination&&(s.status="docked");break;case"docked":f.M.$=Math.min(f.M.$+50,f.M._),s.Ct.Yt.v-=2,s.Ct.Yt.active&&(f.v.k+=2),s.status="charging";break;case"charging":s.Ct.Yt.active&&(s.v=Math.min(s.v+t/1e3*2,30),30===s.v&&(s.status="ready",s.Ct.Yt.v+=2,f.v.k-=2))}var n;s.update(t,i)})),s(".ship-controller").innerText=this.Xt.map((t=>t.id+": "+`${t.status}${"mining"===t.status?`(${Math.floor(t.Ut/1e3)})`:""} ↯`+Math.floor(t.v))).join("\n")}};function P({x:t,y:i,z:s,parent:h}){v.call(this,{x:t,y:i,z:s}),this.id=P.prototype.count++,this.status="ready",this.Ut=0,this.v=30,this.Ct=null,this.speed=0,this.acceleration=.01,this.Tt(h.At[0]),A.Xt.push(this)}P.prototype=Object.create(v.prototype),P.prototype.constructor=P,P.prototype.count=0,P.prototype.qt=function(){const t=new M(this.x,this.y,this.z),i=new M(this.destination.x,this.destination.y,this.destination.z);if(1>t.A(i))return this.destination=null,void this.K.element.classList.remove("thrust");this.K.element.classList.add("thrust");const s=i.X(t),h=s.resize(1);this.x+=h.x,this.y+=h.y,this.z+=h.z,this.t=s.T()+n},P.prototype.update=function(t,i){v.prototype.update.call(this,t,i),this.destination&&this.qt()},P.prototype.Tt=function(t){t.Rt=this,this.Ct=t},P.prototype.Gt=function(){this.Ct&&(this.destination={x:this.Ct.Yt.Wt.x,y:this.Ct.Yt.Wt.y,z:this.Ct.Yt.Wt.z},this.Ct.Rt=null,this.Ct=null)};const R={tag:"MiningShip",ut:"Mining ship",className:"mining ship",it:1};function T({x:t,y:i,z:s,parent:h}){this.K=new H({w:40,d:20,wt:10,x:t,y:i,z:s,className:R.className}),P.call(this,{x:t,y:i,z:s,parent:h,...R}),this.K.nt[2].element.dataset.text=this.id}Object.assign(T,R),T.prototype=Object.create(P.prototype),T.prototype.constructor=T;const W={tag:"Hangar",ut:"Spawns ships which gather metal",className:"hangar module",it:35,v:-10,w:90,wt:84,d:120,Et:2};function Y({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new X({w:W.w,wt:W.wt,d:W.d,x:t,y:i,z:s,rx:h,ry:n,t:e,className:W.className,It:4,Zt:8}),this.K.nt[2].element.className+=" door",this.K.update(),this.At=[],this._t=[T],N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...W})}function C({w:t,d:i,wt:s=.8660254037844386*i,x:e,y:a,z:r,rx:o,ry:c,t:l,className:u}){this.className=(u??"")+" hexagon",k.call(this,{w:t,d:i,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:this.className});const w=.5*t,x=.5*i,d=.25*i,z=.125*i,y=.5*s,p=.25*s,b=Math.hypot(.25*i,.5*s),f=Math.atan(2*s/i);this.nt=[new O({w:i,wt:s,x:w,rx:-n,t:-n,className:"hex"}),new O({w:t,wt:x,z:-y,rx:h}),new O({w:t,wt:b,y:-d-z,z:-p,rx:h-f}),new O({w:t,wt:b,y:-d-z,z:p,rx:f}),new O({w:t,wt:x,z:y}),new O({w:t,wt:b,y:d+z,z:p,rx:-f}),new O({w:t,wt:b,y:d+z,z:-p,rx:h+f}),new O({w:i,wt:s,x:-w,rx:-n,t:n,className:"hex"})],this.nt.forEach((t=>{t.parent=this})),this.element.append(...this.nt.map((t=>t.element)))}Object.assign(Y,W),Y.prototype=Object.create(N.prototype),Y.prototype.constructor=Y,Y.prototype.lt=function(){N.prototype.lt.call(this),this.Lt=new M(1,0,0).rotate(this.rx,this.ry,this.t),this.Wt=this.Lt.resize(this.w).add(new M(this.x,this.y,this.z));for(let t=0;W.Et>t;t++){const t={Yt:this,Rt:null};this.At.push(t)}A.Ht.push(this),A.At.push(...this.At)},Y.prototype.B=function(){A.Ht=A.Ht.filter((t=>t!==this)),A.At=A.At.filter((t=>!this.At.includes(t))),N.prototype.B.call(this)},C.prototype=Object.create(k.prototype),C.prototype.constructor=C;const G={tag:"Hex Block",ut:"Hexagonal building block",className:"hex-block module",it:20,w:60,d:120};function U({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new C({w:G.w,d:G.d,x:t,y:i,z:s,rx:h,ry:n,t:e,className:G.className}),N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...G}),this.K.nt.forEach((t=>{_.et(t)}))}Object.assign(U,G),U.prototype=Object.create(N.prototype),U.prototype.constructor=U,U.prototype.lt=function(){N.prototype.lt.call(this)};const q=Math.sqrt(3)/2;function E({Ft:t,Qt:i,Jt:s=i*q,w:a,d:r,wt:o=r*q,x:c,y:l,z:u,rx:w,ry:x,t:d,className:z}){this.className=(z??"")+" hex-ring",k.call(this,{w:a,d:a,wt:o,x:c,y:l,z:u,rx:w,ry:x,t:d,className:this.className});const y=.5*t,p=.5*i,b=.25*i,f=.125*i,m=.5*s,M=.25*s,_=Math.hypot(.25*i,.5*s),$=a,g=$/Math.sqrt(2),v=.5*a,N=.5*r,j=.25*r,B=.125*r,D=.5*o,S=.25*o,I=Math.hypot(.25*r,.5*o),Z=Math.atan(2*o/r),X=t/6;this.nt=[new O({w:i,wt:s,x:y,rx:-n,t:-n,className:"hex"}),new O({w:t,wt:p,z:-m,rx:h}),new O({w:t,wt:_,y:-b-f,z:-M,rx:h-Z}),new O({w:t,wt:_,y:-b-f,z:M,rx:Z}),new O({w:t,wt:p,z:m}),new O({w:t,wt:_,y:b+f,z:M,rx:-Z}),new O({w:t,wt:_,y:b+f,z:-M,rx:h+Z}),new O({w:i,wt:s,x:-y,rx:-n,t:n,className:"hex"}),new O({w:X,wt:o-2*$,x:-X/2,rx:-n,t:n}),new O({w:X,wt:o-2*$,y:X/2,rx:-n}),new O({w:X,wt:o-2*$,y:-X/2,rx:n}),new O({w:X,wt:o-2*$,x:X/2,rx:-n,t:-n}),new O({w:X,wt:o-2*$,x:-X/2,rx:-n,t:n,ry:e}),new O({w:X,wt:o-2*$,x:X/2,t:n,rx:n,ry:e}),new O({w:X,wt:o-2*$,y:X,rx:e/2}),new O({w:X,wt:o-2*$,y:-X,rx:e/2}),new O({w:r,wt:o,x:v,rx:-n,t:-n,className:"hex-cut"}),new O({w:a,wt:N,z:-D+$,rx:h,ry:h}),new O({w:a,wt:I,y:-j-B+g,z:-S+g,rx:-Z}),new O({w:a,wt:I,y:-j-B+g,z:S-g,rx:-h+Z}),new O({w:a,wt:N,z:D-$,rx:h}),new O({w:a,wt:I,y:j+B-g,z:S-g,rx:h-Z}),new O({w:a,wt:I,y:j+B-g,z:-S+g,rx:Z}),new O({w:a,wt:N,z:-D,rx:h}),new O({w:a,wt:I,y:-j-B,z:-S,rx:h-Z}),new O({w:a,wt:I,y:-j-B,z:S,rx:Z}),new O({w:a,wt:N,z:D}),new O({w:a,wt:I,y:j+B,z:S,rx:-Z}),new O({w:a,wt:I,y:j+B,z:-S,rx:h+Z}),new O({w:r,wt:o,x:-v,rx:-n,t:n,className:"hex-cut"})],this.nt.forEach((t=>{t.parent=this,t.element.style.backfaceVisibility="visible"})),this.element.style.setProperty("--t",$+"px"),this.element.style.setProperty("--tx",g*n+"px"),this.element.style.setProperty("--txy",g+"px"),this.element.append(...this.nt.map((t=>t.element)))}E.prototype=Object.create(k.prototype),E.prototype.constructor=E;const L={tag:"Ring Medium",ut:"Rotating hexagon ring",className:"ring",it:100,v:-20,Ft:60,Qt:50,w:60,d:540};function F({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new E({w:L.w,d:L.d,Ft:L.Ft,Qt:L.Qt,x:t,y:i,z:s,rx:h,ry:n,t:e,className:L.className}),N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...L}),this.Kt=0,_.et(this.K.nt[0]),_.et(this.K.nt[7])}function Q({w:t,d:i=t,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:u}){this.className=(u??"")+" box",k.call(this,{w:t,d:i,wt:s,x:e,y:a,z:r,rx:o,ry:c,t:l,className:this.className});const w=.5*t,x=.5*i,d=.5*s;this.nt=[new O({w:i,wt:s,x:-w,rx:-n,t:n}),new O({w:t,wt:i,z:-d,rx:h}),new O({w:t,wt:s,y:x,rx:-n}),new O({w:t,wt:s,y:-x,rx:n}),new O({w:t,wt:i,z:d}),new O({w:i,wt:s,x:w,rx:-n,t:-n}),new O({w:i,wt:s,x:w,rx:-n,t:n}),new O({w:t,wt:i,z:d,rx:h}),new O({w:t,wt:s,y:-x,rx:-n}),new O({w:t,wt:s,y:x,rx:n}),new O({w:t,wt:i,z:-d}),new O({w:i,wt:s,x:-w,rx:-n,t:-n})],this.nt.forEach((t=>{t.parent=this})),this.element.append(...this.nt.map((t=>t.element)))}Object.assign(F,L),F.prototype=Object.create(N.prototype),F.prototype.constructor=F,F.prototype.lt=function(){N.prototype.lt.call(this)},F.prototype.update=function(t=0,i){N.prototype.update.call(this,t,i),this.active?this.Kt=Math.min(this.Kt+1e-4*t,2):this.Kt=Math.max(this.Kt-1e-4*t,0),this.rx+=this.Kt*t/1e4},Q.prototype=Object.create(k.prototype),Q.prototype.constructor=Q;const J={tag:"Scaffold",ut:"Alternative to the Block module",className:"scaffold module",it:10,w:60,d:60,wt:60};function K({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new Q({w:J.w,wt:J.wt,d:J.d,x:t,y:i,z:s,rx:h,ry:n,t:e,className:J.className}),N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...J}),this.K.nt.forEach((t=>{_.et(t)}))}Object.assign(K,J),K.prototype=Object.create(N.prototype),K.prototype.constructor=K,K.prototype.lt=function(){N.prototype.lt.call(this)};const V={tag:"Solar Panel Basic",ut:"Generates power",className:"solar module",it:35,v:10,w:108,wt:2,d:52};function tt({x:t,y:i,z:s,rx:h,ry:n,t:e}){this.K=new j({w:V.w,wt:V.wt,d:V.d,x:t,y:i,z:s,rx:h,ry:n,t:e,className:V.className}),this.K.nt[1].element.className+=" panel",this.K.nt[4].element.className+=" panel",this.level=0,this.S=2,this.Mt=10,this.info=V,N.call(this,{x:t,y:i,z:s,rx:h,ry:n,t:e,...V})}Object.assign(tt,V),tt.prototype=Object.create(N.prototype),tt.prototype.constructor=tt,tt.prototype.Vt=0,tt.prototype.upgrade=function(){this.ti(this.level+1)},tt.prototype.ti=function(t){this.disable(),this.K.element.classList.remove("lvl-"+this.level),this.level=t,this.K.element.classList.add("lvl-"+this.level),this.v=V.v*(this.level+1),this.enable(),this.K.St({w:V.w*(this.level+1)});const i=this.rt.parent,h=new M(this.rt.x,this.rt.y,this.rt.z).G(i.rx).C(i.ry).Y(i.t),n=h.resize(.5*this.K.w);this.x=i.x+h.x+n.x,this.y=i.y+h.y+n.y,this.z=i.z+h.z+n.z,this.selected&&(s(".ui-panel__build-info").innerHTML=v.prototype.bt.call(this))},tt.prototype.lt=function(){N.prototype.lt.call(this),tt.prototype.Vt++};const it=[K,D,U,tt,Z,Y,F],st=s(".mats .fill"),ht=s(".mats .dot"),nt=s(".mats .cap"),et=s(".pop .cur"),at=s(".pop .cap"),rt=s(".power .fill"),ot=s(".power .dot"),ct=s(".power .gen"),lt=s(".power .use"),ut=s(".power .num"),wt=s(".power .cap"),xt=s(".ui-panel__build-list"),dt=s(".ui-panel__build-info"),zt=s(".del"),yt=s(".off"),pt={ii:[],si:()=>{pt.ii.forEach((t=>{t.setAttribute("aria-pressed",!1)}))},ft:()=>{pt.ii=it.map((t=>{const i=document.createElement("button");return i.className="build-bar "+t.className,i.addEventListener("click",(()=>{_.J(t),pt.ii.forEach((t=>{i===t?t.setAttribute("aria-pressed",!0):t.setAttribute("aria-pressed",!1)}))})),i.addEventListener("mouseover",(()=>{dt.innerHTML=$(t)})),i.addEventListener("mouseleave",(()=>{dt.innerHTML=_.U?$(_.U):""})),xt.append(i),i}))},update:()=>{st.style.width=100/f.M._*f.M.$+"%",ht.classList.toggle("empty",1>f.M.$),nt.innerText=`${Math.floor(f.M.$)} /  ${f.M._}`,et.innerText=f.g.$,at.innerText=f.g._,rt.style.width=100/f.v._*f.v.$+"%",ot.classList.toggle("empty",1>f.v.$),ct.innerText="+"+f.v.N,lt.innerText="-"+f.v.k;const t=f.v.N-f.v.k;ut.innerText=(t>0?"+":"")+t,ut.classList.toggle("neg",0>t),wt.innerText=`${Math.floor(f.v.$)} /  ${f.v._}`}};zt.addEventListener("click",(()=>{for(let t=m.length-1;t>0;t--)m[t].selected&&m[t].B();s(".ui-panel--btns").setAttribute("aria-hidden",!0),s(".ui-panel__build-info").classList.remove("ui-panel__build-info--select"),s(".ui-panel__build-info").innerHTML="",s(".ui-panel__build-list").innerHTML="",s(".ui-panel__build-list").style.display="",s(".ui-panel__build-list").append(...pt.ii),pt.si(),_.J(!1)})),yt.addEventListener("click",(()=>{const t="true"!==yt.getAttribute("aria-pressed");yt.setAttribute("aria-pressed",t);for(let i=m.length-1;i>0;i--)m[i].selected&&(!t&&m[i].enable&&m[i].enable(),t&&m[i].disable&&m[i].disable())}));const bt=new Set;class ft{constructor({x:t,y:i,z:s,Dt:h}){this.direction=new M(t,i,s),this.Dt=h}}function mt({w:t,x:i,y:h,z:e,rx:a,ry:r,t:o}){k.call(this,{w:t,d:t,wt:t,x:i,y:h,z:e,rx:a,ry:r,t:o,className:"skybox"});const c=.5*t;this.nt=[new O({w:t,wt:t,z:-c}),new O({w:t,wt:t,y:c,rx:n}),new O({w:t,wt:t,x:c,rx:-n,t:n}),new O({w:t,wt:t,y:-c,rx:-n}),new O({w:t,wt:t,x:-c,rx:-n,t:-n}),new O({w:t,wt:t,z:c,rx:Math.PI})],this.element.append(...this.nt.map((t=>t.element))),this.yt(),this.nt.forEach((t=>{t.element.addEventListener("mousedown",(()=>{t.hi=!1})),t.element.addEventListener("mousemove",(()=>{t.hi=!0})),t.element.addEventListener("mouseup",(()=>{t.hi||(m.deselectAll(),s(".ui-panel--btns").setAttribute("aria-hidden",!0),s(".ui-panel--info").setAttribute("aria-hidden",!0),s(".ui-panel__build-info").classList.remove("ui-panel__build-info--select"),s(".ui-panel__build-info").innerHTML="",s(".ui-panel__build-list").innerHTML="",s(".ui-panel__build-list").style.display="",s(".ui-panel__build-list").append(...pt.ii),pt.si(),_.J(!1))}))}))}mt.prototype=Object.create(k.prototype),mt.prototype.constructor=mt,mt.prototype.update=function(){this.x=-b.x,this.y=-b.y,this.z=-b.z,this.element.style.transform=`\n    translate3D(${this.x}px, ${this.y}px, ${this.z}px)\n    rotateX(${this.rx})\n    rotateY(${this.ry})\n    rotateZ(${this.t})\n    scale3D(99, 99, 99)`};const Mt=s(".debug .perf");let _t;const $t=new mt({w:2048});new function({x:t,y:i,z:s,r:h}){this.x=t??0,this.y=i??0,this.z=s??0,this.r=h??0,this.color="#f90",this.element=document.createElement("div"),this.element.className="face circle sun",this.element.style.width=2*h+"px",this.element.style.height=2*h+"px",document.querySelector(".scene").append(this.element),b.l.push(this),this.p=()=>{this.element.style.transform=`\n      translate3D(${this.x}px, ${this.y}px, ${this.z}px)\n      rotateZ(${-b.t}rad)\n      rotateY(${-b.ry}rad)\n      rotateX(${-b.rx}rad)\n      scale(40)\n    `},this.p()}({x:4e4,y:4e4,z:1e4,r:200}),new function({x:t,y:i,z:s,r:h}){this.x=t??0,this.y=i??0,this.z=s??0,this.r=h??0,this.element=document.createElement("div"),this.element.className="planet",this.element.style.transform=`\n    translate3D(${this.x}px, ${this.y}px, ${this.z}px)\n  `,this.ni=document.createElement("div"),this.ni.style.width=2*h+"px",this.ni.style.height=2*h+"px",this.ni.className="circle body",this.ei=document.createElement("div"),this.ei.style.width=8*h+"px",this.ei.style.height=8*h+"px",this.ei.className="ring",this.ei.style.transform="\n    scale3D(8, 8, 8)\n  ",this.element.append(this.ni,this.ei),document.querySelector(".scene").append(this.element),b.l.push(this),this.p=()=>{const t=Math.atan2(b.zoom*Math.cos(b.t)-this.y-b.y,b.zoom*Math.sin(b.t)-this.x-b.x);this.ni.style.transform=`\n      rotateZ(${t-n}rad)\n      rotateX(${-b.rx}rad)\n      scale(32)\n    `},this.p()}({x:900,y:-9e3,r:300});const gt=[new ft({x:-1,y:1,z:1,Dt:.6}),new ft({x:-1,y:1,z:0,Dt:.2})],vt=new D({});vt.yt(),vt.enable(),m.push(vt),pt.ft();let Nt=0;!function(){const t=s(".viewport"),i={};t.addEventListener("mousemove",(t=>{t.preventDefault(),void 0!==i.x&&1===t.buttons&&b.rotate(i.x-t.clientX,i.y-t.clientY),i.x=t.clientX,i.y=t.clientY})),t.addEventListener("wheel",(t=>{b.m(t.deltaY)}))}(),document.addEventListener("keydown",(t=>{const i=t.key.toLowerCase();bt.add(i),"r"===i&&_.rotate(),"delete"===i&&(m.j(),s(".ui-panel--btns").setAttribute("aria-hidden",!0),s(".ui-panel__build-info").classList.remove("ui-panel__build-info--select"),s(".ui-panel__build-info").innerHTML="",s(".ui-panel__build-list").innerHTML="",s(".ui-panel__build-list").style.display="",s(".ui-panel__build-list").append(...pt.ii),pt.si()),"u"===i&&m.D(),"escape"===i&&(m.deselectAll(),s(".ui-panel--btns").setAttribute("aria-hidden",!0),s(".ui-panel__build-info").classList.remove("ui-panel__build-info--select"),s(".ui-panel__build-info").innerHTML="",s(".ui-panel__build-list").innerHTML="",s(".ui-panel__build-list").style.display="",s(".ui-panel__build-list").append(...pt.ii),pt.si(),_.J(!1))})),document.addEventListener("keyup",(t=>{bt.delete(t.key.toLowerCase())})),s("#reset-rotation").addEventListener("click",(()=>{b.rx=a,b.t=a,b.setTransform()})),s("#reset-position").addEventListener("click",(()=>{b.x=0,b.y=0,b.z=0,b.setTransform()})),window.requestAnimationFrame((function t(i){window.requestAnimationFrame(t),void 0===_t&&(_t=i);const s=i-_t;Nt+=s,Nt>500&&(Nt=0),bt.has("w")&&(b.h+=1),bt.has("a")&&(b.o-=1),bt.has("s")&&(b.h-=1),bt.has("d")&&(b.o+=1),bt.has("z")&&(b.i+=1),bt.has("x")&&(b.i-=1),A.update(s,gt),m.forEach((t=>{t.update(s,gt)})),b.update(s),$t.update(),_t=i,Mt.innerText=`Elapsed: ${s.toFixed(2)} FPS: ${(1e3/s).toFixed()}`,Nt||(_.update(),f.g.$<f.g._&&Math.floor(1.02*Math.random())&&f.g.$++,pt.update())}))}();</script></body>